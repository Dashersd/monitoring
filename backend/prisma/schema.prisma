// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for Role-Based Access Control
enum Role {
  ADMIN
  SUPERVISOR
  TEACHER
}

enum ActivityStatus {
  PENDING
  APPROVED
  REJECTED
}

// User model for authentication and basic profile
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   // Hashed password
  name      String
  role      Role     @default(TEACHER)
  isActive  Boolean  @default(true) // For Deactivate/Activate
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  teacherProfile TeacherProfile?
  approvals      Approval[]      @relation("Approver")
  notifications  Notification[]
}

// Specific profile for Teachers to track department and credits
model TeacherProfile {
  id           Int        @id @default(autoincrement())
  userId       Int        @unique
  departmentId Int
  
  // Relations
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  department   Department @relation(fields: [departmentId], references: [id])
  activities   Activity[]
}

// Departments (e.g., Science, Math, English)
model Department {
  id          Int              @id @default(autoincrement())
  name        String           @unique
  description String?
  
  // Relations
  teachers    TeacherProfile[]
}

// Categories for Service Credits (e.g., Training, Committee, Event)
model ServiceCategory {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  description String?
  
  // Relations
  activities  Activity[]
}

// Activity Submissions
model Activity {
  id          Int            @id @default(autoincrement())
  title       String
  description String?
  date        DateTime
  durationHours Float
  status      ActivityStatus @default(PENDING)
  
  // Foreign Keys
  teacherId   Int
  categoryId  Int
  
  // Relations
  teacher     TeacherProfile  @relation(fields: [teacherId], references: [id])
  category    ServiceCategory @relation(fields: [categoryId], references: [id])
  approvals   Approval[]
  attachments Attachment[]
  
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

// Approvals/Rejections by Admin or Supervisor
model Approval {
  id         Int            @id @default(autoincrement())
  comments   String?
  status     ActivityStatus
  
  // Foreign Keys
  activityId Int
  approverId Int
  
  // Relations
  activity   Activity @relation(fields: [activityId], references: [id])
  approver   User     @relation("Approver", fields: [approverId], references: [id])
  
  createdAt  DateTime @default(now())
}

// File Attachments for Evidence
model Attachment {
  id         Int      @id @default(autoincrement())
  filePath   String   // URL or path to file
  fileType   String?
  
  activityId Int
  activity   Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)
}

// System Notifications
model Notification {
  id        Int      @id @default(autoincrement())
  message   String
  isRead    Boolean  @default(false)
  
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  
  createdAt DateTime @default(now())
}
